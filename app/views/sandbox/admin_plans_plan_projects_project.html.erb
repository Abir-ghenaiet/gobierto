<div class="admin_breadcrumb">
  <%= link_to 'Inicio', 'admin' %> »
  <%= link_to 'Planificación', 'admin_plans' %> »
  <%= link_to 'Plan Actuación Municipal', 'admin_plans_plan' %> »

</div>

<h1>Proyectos de Plan Actuación Municipal</h1>

<div class="tabs">
  <ul>
    <li><%= link_to 'Plan', 'admin_plans_plan' %></li>
    <li class="active"><%= link_to 'Proyectos', 'admin_plans_plan_projects' %></li>
    <li><%= link_to 'Configuración', 'admin_plans_plan_conf' %></li>
  </ul>
</div>

<div class="pure-g">

  <div class="pure-u-1 pure-u-md-17-24">

    <form>

      <div class="form_item select_control">
        <label for="entity">Categoría</label>
        <!-- should show the list from sandbox/admin_people_conf -->
        <select>
          <% for i in [
            'Eje 1 - Economia, emprenedoria i ocupació',
            'Eje 2 - Buen Gobierno',
            'Eje 3 - Sostenibilidad',
            'Eje 4 - Felicidad',
            'Eje 5 - Eficiencia'
          ]
          %>
          <option><%= i %></option>
          <% end %>
        </select>
      </div>

      <div class="globalized_fields">

        <%= render partial: "admin_globalized_fields"  %>

        <div class="form_item input_text">
          <label for="a1">Proyecto</label>
          <input type="text" id="a1" value="Título del proyecto">
        </div>

        <div class="form_item textarea">
          <label for="entity">Descripción</label>
          <textarea>Más info... </textarea>
          <div class="inline_help"></div>
        </div>

      </div>

      <div class="f_flex_col">

        <div class="form_item input_text">
          <label for="event_starts_at">Fecha de inicio</label>
          <input data-language="es" data-timepicker="true" data-autoclose="false" data-date-format="yyyy-mm-dd" data-time-format="hh:ii" data-startdate="1552669200000" data-bind="true" class="air-datepicker" type="text" value="2019-03-15 18:00:00 +0100" name="event[starts_at]" id="event_starts_at">
        </div>

        <div class="form_item input_text">
          <label for="event_starts_at">Fecha de fin</label>
          <input data-language="es" data-timepicker="true" data-autoclose="false" data-date-format="yyyy-mm-dd" data-time-format="hh:ii" data-startdate="1552669200000" data-bind="true" class="air-datepicker" type="text" value="2019-03-15 18:00:00 +0100" name="event[starts_at]" id="event_starts_at">
        </div>

        <div class="form_item select_control">
          <label for="">Estado</label>
          <select>
            <% for i in [
              'Pendiente iniciar',
              'Iniciado',
              'En progreso',
              'Finalizado'
            ]
            %>
            <option><%= i %></option>
            <% end %>
          </select>
        </div>

        <div class="form_item select_control">
          <label for="">Progreso</label>
          <select>
            <option>0%</option>
            <option>25%</option>
            <option>50%</option>
            <option>75%</option>
            <option>100%</option>
            <option disabled>- - - -</option>
            <% for i in 1..100 %>
              <option><%= i %>%</option>
            <% end %>
          </select>
        </div>

      </div>


      <h3>Indicadores</h3>

      <div class="v_container">

        <div class="v_heading">
          <div>
            
          </div>

          <div class="v_el_decorated">
            <div>
              Items
            </div>
            <div>
              Estado
            </div>
          </div>

          <div class="v_el_actions"></div>

        </div>

        <% for i in [
          'Estado de implantación de proyectos (interno)',
          'Estado de implantación de proyectos'
        ] %>
        <div class="v_el v_el_level v_el_full_content">
          <div class="v_el_cont">
            <div class="v_el_icon_tree"><%= link_to '<i class="fas icon-caret fa-caret-right"></i>'.html_safe, '' %></div>
            <div class="v_el_title"><%= i %></div>
            <div class="v_el_decorated">
              <div>
                4
              </div>
              <div>
                Borrador
              </div>
            </div>
            <div class="v_el_actions">
              <%= link_to '<i class="fas icon fa-edit"></i>'.html_safe, '#modal_edit_term', class: 'open_modal' %>
              <%= link_to '<i class="fas icon fa-trash"></i>'.html_safe, '' %>
            </div>
          </div>

          <div class="v_el v_el_content tipsit" title="Arrastra">

            <div class="view_type" style="display: none">
              Ver

              <div class="view_type_icon selected">
                <i class="fas fa-table"></i>
              </div>

              <div class="view_type_icon">
                <i class="fas fa-chart-area"></i>
              </div>

            </div>

            <div class="indicators_table">

              TABLE

            </div>

            <div class="indicators_chart go_card_container_grid" style="display: none">

              <% for i in [
                'Proyectos implantados',
                'Proyectos en fase de implantación',
                'Proyectos que comenzararán la implantación en menos de 6 meses',
                'Municipios sin plan definido'
              ] %>
              <div class="go_card">
                <div class="go_card_"><% i %></div>
                <div class=""></div>
              </div>
              <% end %>

            </div>


          </div>

        </div>
        <% end %>

      </div>


    </form>

  </div>

  <div class="pure-u-1 pure-u-md-1-24"></div>

  <div class="pure-u-1 pure-u-md-1-4">

    <%# render "admin_widget_save.html.erb", locals: { only_save_button: true } %>

    <%= render "admin_widget_save_v2.html.erb", locals: { only_save_button: true } %>

    <div class="widget_save_v2 m_b_2">

      <div class="w_s_content">

        <h4>Moderación</h4>

        <div class="form_item">

          <div class="options compact">

        		<div class="option">
              <input type="radio" id="opt_1" name="opt" value="1" checked="">
              <label for="opt_1">
                <span></span>
                En revisión
             </label>
            </div>

            <div class="option">
              <input type="radio" id="opt_2" name="opt" value="2">
              <label for="opt_2">
                <span></span>
                Aprobado
              </label>
            </div>

            <div class="option">
              <input type="radio" id="opt_2" name="opt" value="2">
              <label for="opt_2">
                <span></span>
                Rechazado
              </label>
            </div>

          </div>

        </div>

        <div class="w_actions m_b_1">
          <button class="button medium">Guardar</button>
        </div>

      </div>

    </div>

    <%# render "admin_widget_attachment.html.erb" %>


  </div>

</div>

<script type="text/javascript">

$(document).ready(function(){

  // Toggle selected element child
  $('.v_container .v_el .icon-caret').click(function(e) {
    e.preventDefault();

    // ToDo: Don't relay on icon specific names
    if($(this).is('.fa-caret-right')) {
      $(this).removeClass('fa-caret-right');
      $(this).addClass('fa-caret-down');
    }
    else {
      $(this).removeClass('fa-caret-down');
      $(this).addClass('fa-caret-right');
    }

    $(this).parent().parent().parent().parent().find('> .v_el').toggleClass('el-opened');

  });

  // Close all elements except first level
  $('.v_container .v_heading .fa-caret-square-right').click(function(e) {
    // closes all elements
    $('.v_container .v_el_level .v_el').removeClass('el-opened');
  });

  // Open all elements except first level
  $('.v_container .v_heading .fa-caret-square-down').click(function(e) {
    // Opens all elements
    $('.v_container .v_el_level .v_el').addClass('el-opened');
  });

  // show only action buttons (edit, delete) when hovering an item
  // ToDo: Control that only elements for the item are shown, not for it's parents
  $('.v_el').hover(
    function(e) {
      $(this).first('.v_el_actions').addClass('v_el_active');
    },
    function(e) {
      $(this).first('.v_el_actions').removeClass('v_el_active');
    }
  );

  // only for sandbox
  $('.sandbox_remove_decorated_content').click(function(e) {
    $('.v_el_decorated').toggle();
  });

});
</script>
