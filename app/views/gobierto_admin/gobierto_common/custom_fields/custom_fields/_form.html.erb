<%= render "gobierto_admin/shared/validation_errors", resource: @custom_field_form %>

<%= form_for(@custom_field_form,
             as: :custom_field,
             url: @custom_field_form.persisted? ? admin_common_custom_fields_custom_field_path(@custom_field_form) : admin_common_custom_fields_module_resource_custom_fields_path(module_resource_name: @custom_field_form.resource_name),
             data: { 'globalized-form-container' => true }) do |f| %>
  <%= f.hidden_field :instance_class_name %>
  <%= f.hidden_field :instance_id %>

  <div class="pure-g">
    <div class="pure-u-1 pure-u-md-16-24">

      <div class="globalized_fields">
        <%= render "gobierto_admin/shared/form_locale_switchers" %>

        <% current_site.configuration.available_locales.each do |locale| %>
          <div class="form_item input_text" data-locale="<%= locale %>">
            <%= label_tag "custom_field[name_translations][#{locale}]" do %>
              <%= f.object.class.human_attribute_name(:name) %>
              <%= attribute_indication_tag required: true %>
            <% end %>
            <%= text_field_tag "custom_field[name_translations][#{locale}]", f.object.name_translations && f.object.name_translations[locale] %>
          </div>
        <% end %>
      </div>

      <div class="form_item input_text">
        <%= f.label :uid do %>
          <%= f.object.class.human_attribute_name(:uid) %>
          <%= attribute_indication_tag required: true %>
        <% end %>
        <%= f.text_field :uid %>
      </div>

      <div class="form_block">
        <div class="form_item site-module-check-boxes">
          <div class="options compact">
            <h4><%= f.object.class.human_attribute_name(:field_type) %></h4>
            <%= f.collection_radio_buttons(:field_type, @custom_field_form.available_field_types, :first, :first) do |b| %>
              <div class="option">
                <%= b.radio_button(
                      data: {
                        type: b.text,
                        has_options: @types_with_options.include?(b.text),
                        has_vocabulary: @types_with_vocabulary.include?(b.text)
                      }
                    ) %>
                <%= b.label do %>
                  <span></span>
                  <%= f.object.class.human_attribute_name(b.text) %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="form_block configuration">
        <div class="form_item">
          <%= content_tag :div,
                id: "vocabulary",
                style: @custom_field_form.has_vocabulary? ? nil : "display: none;" do %>
            <%= render partial: "vocabulary_select", locals: { f: f } %>
          <% end %>
          <%= content_tag :div,
                id: "options",
                style: @custom_field_form.has_options? ? nil : "display: none;" do %>
            <%= render partial: "options_form", locals: { f: f } %>
          <% end %>
          <%= content_tag :div,
                id: "plugin",
                style: @custom_field_form.custom_field.plugin? ? nil : "display: none;" do %>
            <%= render partial: "plugin", locals: { f: f } %>
          <% end %>
        </div>
      </div>

    </div>

    <div class="pure-u-1 pure-u-md-2-24"></div>

    <%= render partial: 'gobierto_admin/shared/save_widget', locals: { f: f, levels: [] } %>
  </div>
<% end %>

<% content_for :javascript_hook do %>
  <%= javascript_tag do %>
    window.GobiertoAdmin.gobierto_common_custom_fields_controller = new GobiertoAdmin.GobiertoCommonCustomFieldsController
    window.GobiertoAdmin.gobierto_common_custom_fields_controller.handleForm();
  <% end %>
<% end %>
