<% title t('.title', year: @year) %>

<% content_for :body_attributes do %>
  <%== %Q{data-bubbles-data="#{bubbles_data_path(current_site)}" data-max-year="#{Date.today.year}"} %>
<% end %>

<div id="indicator-form" data-indicator="<%= @indicator_json %>"></div>

<div class="column indicators-tree">

  <div class="block">

    <div class="pure-g header_block_inline">
      <div class="pure-u-1 pure-u-md-12-24">
        <div class="inline_header">
          <h2 class="with_description p_h_r_1"><%= t('.ita_title') %></h2>
          <%= render partial: 'gobierto_indicators/indicators/year_breadcrumb', locals: {path_calculation_method: :gobierto_indicators_ita_path} %>
        </div>

        <p v-if="!selected">
          <%= t('.ita_description') %>
        </p>
      </div>

      <div class="pure-u-1 pure-u-md-12-24 right" v-if="!selected">
        <%= image_tag('illustrations/personaliza.jpg', class: 'img_header m_v_4') %>
      </div>
    </div>

  </div>

  <div class="block">
    <div id="indicators-tree" class="p_v_1">

      <ul class="item-root item-root--notree" v-if="selected">
        <item-view-wrap :model="selected"></item-view-wrap>
      </ul>

      <ul v-for="model in json" class="item-root" v-else>
        <item-tree class="item" :model="model"></item-tree>
      </ul>

    </div>
  </div>
</div>

<!-- item template -->
<script type="text/x-template" id="item-tree-template">
  <li :class="getLevelClass(model.level)">
    <div @click="toggle" class="item-title">
      <div class="item-toggle p_h_r_1" v-if="hasChildren">
        <div class="toggle-container">
          <i class="fa fa-caret-down"></i>
        </div>
      </div>
      <div class="item-id p_h_r_1" v-else>{{model.id}}</div>

      <div class="item-text" v-if="hasChildren">
        {{model.attributes.title}}
      </div>
      <div class="item-text" @click="viewDetail" v-else>
        {{model.attributes.title}}
      </div>

      <div class="item-check" v-if="!hasChildren">
        <div class="check-container" :class="(model.attributes.checked) ? 'check-container--true' : 'check-container--false'">
          <i class="fa fa-check" v-if="model.attributes.checked"></i>
          <i class="fa fa-times" v-else></i>
        </div>
      </div>
    </div>
    <ul v-show="open" v-if="hasChildren">
      <item-tree class="item" v-for="model in model.children" :model="model" :key="model.id"></item-tree>
    </ul>
  </li>
</script>

<!-- item view template -->
<script type="text/x-template" id="item-view-template">
  <li class="item item-lvl-2">
    <div class="item-title">
      <div class="item-id p_h_r_1">{{ model.id }}</div>
      <div class="item-text">
        <span>{{ model.attributes.title }}</span>
      </div>
      <div class="item-check">
        <div class="row">
          <div class="check-container check-container--true" :class="{ 'check-container--unchecked' : !model.attributes.checked }">
            <i class="fa fa-check"></i>
          </div>
          <div class="check-container check-container--false" :class="{ 'check-container--unchecked' : model.attributes.checked }">
            <i class="fa fa-times"></i>
          </div>
        </div>
        <div class="row">
          <div class="check-container" :class="{ 'check-container--unchecked' : !model.attributes.checked }">
            se cumple
          </div>
          <div class="check-container" :class="{ 'check-container--unchecked' : model.attributes.checked }">
            no se cumple
          </div>
        </div>
      </div>
    </div>
    <div class="item-extrainfo p_h_2 mt3">
      Más información
      <a href="#">Plantilla del consejo <i class="fa fa-share-square-o"></i></a>
      <a href="#">Catàleg de llocs de treball de personal funcionari i laboral, amb indicació de les retribucions <i class="fa fa-share-square-o"></i></a>
      <a href="#">Retribucions dels càrrecs polítics de l'alcalde, regidors i regidores<i class="fa fa-share-square-o"></i></a>
    </div>
  </li>
</script>

<!-- item view wrap template -->
<script type="text/x-template" id="item-view-wrap-template">
  <li @click="unselect" class="item item-lvl-1">
    <div class="item-title">
      <div class="item-toggle p_h_r_1">
        <div class="toggle-container">
          <i class="fa fa-caret-left"></i>
        </div>
      </div>
      <div class="item-text">
        {{ title }}
      </div>
    </div>
    <ul>
      <item-view :model="model" v-if="!hasAncestors"></item-view>
      <item-view-wrap :model="model" v-else></item-view-wrap>
    </ul>
  </li>
</script>

<% content_for :javascript_hook do %>
  <%= javascript_tag do %>
    window.GobiertoIndicators.indicators_controller.show();
  <% end %>
<% end %>
