<template>
  <nav class="gobierto-pagination">
    <button
      class="gobierto-pagination-btn"
      :disabled="page === 1"
      @click="page--"
    >
      Previous
    </button>
    <ul class="gobierto-pagination-pages">
      <li
        v-for="pageNumber in paginationOptions"
        :key="pageNumber"
        class="gobierto-pagination-pages-element"
      >
        <button
          class="gobierto-pagination-pages-element-btn"
          :disabled="pageNumber === page"
          @click="page = pageNumber"
        >
          {{ pageNumber }}
        </button>
      </li>
    </ul>
    <button
      class="gobierto-pagination-btn"
      :disabled="page === pages.slice(-1)[0]"
      @click="page++"
    >
      Next
    </button>
  </nav>
</template>

<script>

export default {
  name: "Pagination",
  props: {
    data: {
      type: Array,
      default: () => []
    },
    itemsPerPage: {
      type: Number,
      default: 1
    },
  },
  data() {
    return {
      labelEmpty: I18n.t("gobierto_dashboards.dashboards.contracts.empty_table"),
      page: 1,
      pages: [],
    };
  },
  computed: {
    displayedData() {
      return this.paginateData(this.data);
    },
    paginationOptions() {
      let page = this.page;
      let len = this.pages.length;
      if (page - len >= -1 && len > 3) {
        return this.pages.slice(page - ((page - len) + (5 < len ? 5 : len)), len);
      } else {
        return this.pages.slice(page - (page < 4 ? page : 3), page + (5 - (page < 4 ? page : 3)));
      }
    }
  },
  watch:{
    perPage(value) {
      if (typeof value === 'string' && value.length < 3) {
        this.page = 1;
        this.setPages();
      }
    },
    page(newValue, oldValue) {
      if (newValue !== oldValue) {
        this.paginateData(this.data);
      }
    }
  },
  created() {
    this.setPages();
    this.paginateData(this.data);
  },
  methods: {
    setPages() {
      this.pages.splice(0, this.pages.length);
      let pageCount = Math.ceil(this.data.length / this.itemsPerPage);
      for (let index = 1; index <= pageCount; index++) {
        this.pages.push(index);
      }
    },
    paginateData(data) {
      let page = this.page;
      let perPage = this.itemsPerPage;
      let from = (page * perPage) - perPage;
      let to = (page * perPage);
      const displayedData = data.slice(from, to);
      this.$emit('showData', displayedData)
    }
  }
};
</script>
